<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Windy Embed + Reverse Geocoding + Marker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input { margin: 5px; padding: 5px; }
    iframe { margin-top: 15px; border: none; display: block; }
    #alamat { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
    #map { height: 300px; margin-top: 20px; }
  </style>

  <!-- Tambahkan Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
  <h3>Pilih Lokasi</h3>
  
  <label for="lat">Latitude:</label>
  <input type="text" id="lat" value="-7.8095">

  <label for="lon">Longitude:</label>
  <input type="text" id="lon" value="110.3705">

  <button onclick="updateMaps()">Tampilkan</button>
  
  <br><br>
  <!-- Iframe Map -->
  <iframe  
    id="windyMap"
    width="100%" 
    height="450" 
    src="https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=mm&metricTemp=°C&metricWind=m/s&zoom=8&overlay=radar&product=radar&level=surface&lat=-7.466&lon=109.935">
  </iframe>

  <!-- Iframe Forecast -->
  <iframe 
    id="windyForecast"
    width="650" 
    height="187" 
    src="https://embed.windy.com/embed.html?type=forecast&location=coordinates&detail=true&detailLat=-7.8095&detailLon=110.3705&metricTemp=default&metricRain=default&metricWind=default">
  </iframe>

  <!-- Info Alamat -->
  <div id="alamat">Alamat lokasi akan tampil di sini...</div>

  <!-- Peta Leaflet -->
  <div id="map"></div>

  <!-- Tambahkan Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Inisialisasi Leaflet map
    var map = L.map('map').setView([-7.8095, 110.3705], 11);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    var marker = L.marker([-7.8095, 110.3705]).addTo(map);

    async function updateMaps() {
      let lat = parseFloat(document.getElementById("lat").value);
      let lon = parseFloat(document.getElementById("lon").value);

      // update iframe map
      document.getElementById("windyMap").src = 
        `https://embed.windy.com/embed.html?type=map&location=coordinates&metricRain=mm&metricTemp=°C&metricWind=m/s&zoom=8&overlay=radar&product=radar&level=surface&lat=${lat}&lon=${lon}`;

      // update iframe forecast
      document.getElementById("windyForecast").src = 
        `https://embed.windy.com/embed.html?type=forecast&location=coordinates&detail=true&detailLat=${lat}&detailLon=${lon}&metricTemp=default&metricRain=default&metricWind=default`;

      // update marker Leaflet
      marker.setLatLng([lat, lon]);
      map.setView([lat, lon], 11);

      // panggil reverse geocoding API (Nominatim OSM)
      let url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;

      try {
        let res = await fetch(url);
        let data = await res.json();

        let addr = data.address;
        let desa = addr.village || addr.hamlet || addr.town || "-";
        let kecamatan = addr.suburb || addr.county || "-";
        let kabupaten = addr.city || addr.municipality || addr.state_district || "-";
        let provinsi = addr.state || "-";

        document.getElementById("alamat").innerHTML = `
          <b>Hasil Identifikasi:</b><br>
          Desa/Kelurahan: ${desa}<br>
          Kecamatan: ${kecamatan}<br>
          Kabupaten/Kota: ${kabupaten}<br>
          Provinsi: ${provinsi}
        `;
      } catch (e) {
        document.getElementById("alamat").innerHTML = "Gagal mengambil data alamat.";
      }
    }
  </script>
</body>
</html>
