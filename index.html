<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Prakiraan Cuaca BMKG by Koordinat</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input { margin: 5px; padding: 5px; }
    #hasil { margin-top: 20px; padding: 10px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h3>Cek Cuaca BMKG dari Koordinat</h3>
  
  <label>Latitude:</label>
  <input type="text" id="lat" value="-7.8095">
  <label>Longitude:</label>
  <input type="text" id="lon" value="110.3705">
  <button onclick="cekCuaca()">Tampilkan</button>
  
  <div id="hasil">Hasil akan muncul di sini...</div>

  <script>
    // Contoh dictionary kecil mapping nama desa/kecamatan -> adm4 (aslinya perlu file JSON lengkap)
    const kodeWilayah = {
      "Caturtunggal": "34.04.16.2001", // contoh: Kelurahan Caturtunggal, Sleman
      "Condongcatur": "34.04.16.1001",
      "Sinduadi": "34.04.13.1001"
      // tambahkan data lengkap sesuai kebutuhan
    };

    async function cekCuaca() {
      let lat = document.getElementById("lat").value;
      let lon = document.getElementById("lon").value;
      let hasilDiv = document.getElementById("hasil");

      // 1. Reverse geocoding (ambil nama desa/kecamatan)
      let url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;
      let res = await fetch(url);
      let data = await res.json();

      let addr = data.address;
      let kelurahan = addr.village || addr.hamlet || addr.town || addr.suburb || "-";

      // 2. Cari kode adm4
      let kode = kodeWilayah[kelurahan];

      if (!kode) {
        hasilDiv.innerHTML = `❌ Lokasi <b>${kelurahan}</b> belum ada di mapping kodeWilayah.`;
        return;
      }

      // 3. Panggil API BMKG
      let urlBMKG = `https://api.bmkg.go.id/publik/prakiraan-cuaca?adm4=${kode}`;
      let resBMKG = await fetch(urlBMKG);
      let dataBMKG = await resBMKG.json();

      // 4. Tampilkan cuaca (contoh: ambil 3 jam pertama)
      let cuaca = dataBMKG.data[0].cuaca;
      let waktu = dataBMKG.data[0].jamCuaca;

      hasilDiv.innerHTML = `
        <b>Lokasi:</b> ${kelurahan} <br>
        <b>Kode adm4:</b> ${kode} <br><br>
        <b>Prakiraan:</b><br>
        Jam ${waktu} → ${cuaca}
      `;
    }
  </script>
</body>
</html>
